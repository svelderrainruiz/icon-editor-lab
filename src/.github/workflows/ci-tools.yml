
name: CI - tools (Pester)

on:
  push:
    branches: [ main, master, develop ]
  pull_request:

jobs:
  test-tools:
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup PowerShell
        uses: PowerShell/PowerShell@v1
        with:
          version: '7.4.x'

      - name: Install Pester
        shell: pwsh
        run: |
          Set-PSRepository -Name 'PSGallery' -InstallationPolicy Trusted
          Install-Module -Name Pester -Force -MinimumVersion 5.4.0 -Scope CurrentUser

      - name: Run tools tests
        shell: pwsh
        run: |
          ./tools/Invoke-ToolsCI.ps1 -InstallPester -ResultsPath artifacts

      - name: Publish test artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: tools-pester-artifacts
          path: artifacts/**
