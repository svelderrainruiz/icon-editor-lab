name: "Run Unit Tests"
description: "Runs RunUnitTests.ps1 to execute LabVIEW unit tests via g-cli."
runs:
  using: "composite"
  steps:
    - name: Checkout code
      uses: actions/checkout@v3
      with:
        fetch-depth: 0

    - name: Run RunUnitTests.ps1
      shell: pwsh
      run: |
        $label = if ("${{ inputs.label }}") { "${{ inputs.label }}" } else { "run-unit-tests-${{ inputs.supported_bitness }}" }
        $arguments = @(
          '-NoLogo','-NoProfile',
          '-File', "${{ github.action_path }}/RunUnitTests.ps1",
          '-MinimumSupportedLVVersion', '${{ inputs.minimum_supported_lv_version }}',
          '-SupportedBitness', '${{ inputs.supported_bitness }}',
          '-ProjectPath', "${{ inputs.project-file }}",
          '-ReportLabel', $label
        )

        pwsh -File tools/Invoke-WithTranscript.ps1 `
          -Label $label `
          -Command pwsh `
          -Arguments $arguments
inputs:
  minimum_supported_lv_version:
    description: 'LabVIEW major version'
    required: true
  supported_bitness:
    description: '32 or 64'
    required: true
  project-file:
    description: 'Path to the LabVIEW project to test (relative or absolute).'
    required: false
    default: vendor/icon-editor/lv_icon_editor.lvproj
  label:
    description: 'Optional label applied to the run report and transcript.'
    required: false
